{% extends "base.html" %}

{% block title %}All Lessons - Educational Platform{% endblock %}

{% block content %}
    <h1>All Lessons</h1>
    {% if current_user.is_authenticated %}
        <p>Debug: User is authenticated (ID: {{ current_user.id }})</p>
        {% if current_user.is_admin %}
            <p>Debug: User is admin</p>
        {% endif %}
    {% else %}
        <p>Debug: User is not authenticated</p>
    {% endif %}
    {% if lessons %}
        <p>Debug: Number of lessons: {{ lessons|length }}</p>
        <ul>
        {% for lesson in lessons %}
            <li>
                <strong>{{ lesson.title }}</strong> 
                (Course: <a href="{{ url_for('course_details', course_id=lesson.course_id) }}">{{ courses[lesson.course_id].title }}</a>)
                - Order: {{ lesson.order }}
                {% if current_user.is_authenticated and (current_user.id == courses[lesson.course_id].instructor_id or current_user.is_admin) %}
                    <a href="{{ url_for('edit_lesson', course_id=lesson.course_id, lesson_id=lesson.id) }}" class="btn btn-secondary btn-sm">Edit</a>
                    <form action="{{ url_for('delete_lesson', course_id=lesson.course_id, lesson_id=lesson.id) }}" method="POST" style="display: inline;">
                        <input type="submit" value="Delete" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this lesson?');">
                    </form>
                {% endif %}
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No lessons available at the moment.</p>
    {% endif %}
    {% if current_user.is_authenticated %}
        {% if courses %}
            <h2>Create a New Lesson</h2>
            <form method="GET" action="{{ url_for('create_lesson', course_id=courses|first) }}">
                <label for="course_select">Select a course:</label>
                <select name="course_id" id="course_select">
                    {% for course_id, course in courses.items() %}
                        <option value="{{ course_id }}">{{ course.title }}</option>
                    {% endfor %}
                </select>
                <input type="submit" value="Create New Lesson" class="btn btn-primary">
            </form>
        {% else %}
            <p>To create a lesson, you need to create a course first. <a href="{{ url_for('create_course') }}">Create a course</a></p>
        {% endif %}
    {% endif %}
{% endblock %}
